require 'spec_helper'

describe Navigation::Item, '#render' do

  class FakeContext
    def generate_path(name, params)
      "/#{name}/#{params}"
    end

    def current_path
      "/foo/"
    end
  end

  # TODO automate this
  this_spec = 'Navigation::Item#render'

  let(:application) { FakeContext.new  }
  let(:object)      { described_class.new(attributes) }

  subject { object.render(application) }

  shared_examples_for this_spec do
    it { should be_a(HTML::Fragment) }
    its(:to_s) { should eql(expected_html) }
  end

  context 'without children' do
    context 'when inactive' do
      let(:attributes) do
        {
          :name     => 'foo',
          :label    => 'Foo',
          :params   => '{}',
          :children => Navigation::Collection::EMPTY
        }
      end

      let(:expected_html) do
        '<a href="/foo/{}">Foo</a>'
      end

      it_should_behave_like this_spec
    end

    context 'when active' do
      let(:attributes) do
        {
          :name     => 'foo',
          :label    => 'Foo',
          :params   => '',
          :children => Navigation::Collection::EMPTY
        }
      end

      let(:expected_html) do
        '<a href="/foo/" class="active">Foo</a>'
      end

      it_should_behave_like this_spec
    end
  end

  context 'with chidren' do
    let(:attributes) do
      {
        :name     => 'foo',
        :label    => 'Foo',
        :params   => '{}',
        :children => Navigation::Collection.new(children)
      }
    end

    let(:children) do
      [
        Navigation::Item.new(
          :name     => 'bar',
          :label    => 'Bar',
          :params   => '{}',
          :children => Navigation::Collection::EMPTY
        ),
        Navigation::Item.new(
          :name     => 'baz',
          :label    => 'Baz',
          :params   => '{}',
          :children => Navigation::Collection::EMPTY
        )
      ]
    end

    let(:expected_html) do
      '<a href="/foo/{}">Foo</a>'            +
      '<ul>'                                 +
        '<li><a href="/bar/{}">Bar</a></li>' +
        '<li><a href="/baz/{}">Baz</a></li>' +
      '</ul>'
    end

    it_should_behave_like this_spec
  end
end
